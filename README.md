# Echo

## Описание проекта

Echo — веб-приложение для управления событиями и совместными бюджетами. Пользователи могут создавать мероприятия, приглашать участников, вести учёт расходов и распределять задачи между участниками.

Основные возможности:
- создание и редактирование событий с датами, местом и участниками;
- управление участниками и их статусами (приглашён, участвует и т.д.);
- бюджеты по событиям с разбивкой расходов по участникам и отметками об оплате;
- задачи в рамках события: создание, назначение исполнителя, смена статусов (новая, в работе, на проверке, выполнена);
- аутентификация по JWT.

Бэкенд — FastAPI (Python 3.12), фронтенд — HTML/CSS/JavaScript, БД — PostgreSQL. Развёртывание — Docker Compose (приложение, БД, Nginx).

## Структура проекта

```
echo/
├── app/                    # Backend (FastAPI)
│   ├── main.py             # Точка входа, uvicorn
│   ├── config.py           # Настройки (pydantic-settings)
│   └── src/
│       ├── api/            # Маршруты API
│       │   ├── api.py      # Подключение роутеров
│       │   ├── duty.py     # Служебные endpoints
│       │   └── v1/         # auth, event, user, budget, task
│       ├── services/       # Бизнес-логика
│       │   ├── auth.py
│       │   ├── event.py
│       │   ├── budget.py
│       │   └── task.py
│       ├── db/             # Доступ к данным (слой БД)
│       │   ├── core.py
│       │   ├── user.py
│       │   ├── event.py
│       │   ├── budget.py
│       │   └── task.py
│       ├── models/         # SQLAlchemy-модели
│       │   ├── base.py
│       │   ├── user.py
│       │   ├── event.py
│       │   ├── event_member.py
│       │   ├── budget.py
│       │   ├── expense_participant.py
│       │   ├── task.py
│       │   ├── role.py
│       │   └── media.py
│       └── schemas/        # Pydantic-схемы запросов/ответов
│           ├── user.py
│           ├── event.py
│           ├── budget.py
│           └── task.py
├── newui/                  # Frontend
│   ├── html/               # Страницы (first-page, event-config, budget, task-page и др.)
│   ├── css/
│   ├── js/                 # api.js, eventApi.js, budgetApi.js, taskApi.js и др.
│   └── images/
├── docker/
│   ├── Dockerfile          # Образ приложения
│   ├── docker-compose.yml  # app, postgre-db, nginx
│   └── nginx.conf          # Раздача статики и проксирование /api/ на backend
├── docs/
│   ├── architecture.md     # Описание архитектуры
│   └── task_migration.sql  # Миграции по задачам
├── requirements.txt
└── .env                    # Переменные окружения (не в репозитории)
```

## Настройка окружения

### Требования

- Docker и Docker Compose (рекомендуемый способ запуска);
- либо Python 3.12+, PostgreSQL 17 и установленные зависимости из `requirements.txt`.

### Переменные окружения

В корне проекта создайте файл `.env` (он не коммитится). Минимальный набор:

```env
# Приложение
name=echo
app_host=0.0.0.0
app_port=8000

# PostgreSQL (для Docker: db_host=postgre-db задаётся в docker-compose)
db_host=localhost
db_port=5432
db_name=echo_db
db_user=postgres
db_password=postgres
db_echo=false

# JWT
secret_key=<ваш_секретный_ключ>
```

При запуске через Docker Compose `db_host` переопределяется на `postgre-db` в `docker-compose.yml`.

### Запуск только backend (без Docker)

```bash
cd app
pip install -r ../requirements.txt
# Убедитесь, что PostgreSQL запущен и создана БД echo_db
export PYTHONPATH=..
python main.py
```

API будет доступен на `http://localhost:8000`. Фронтенд при этом нужно открывать отдельно (например, раздавать `newui` любым HTTP-сервером) и настроить обращение к API (по умолчанию Nginx проксирует `/api/` на backend).

## Как запускать

### Запуск через Docker Compose (рекомендуется)

Из корня репозитория:

```bash
docker compose -f docker/docker-compose.yml up --build
```

После старта:
- веб-интерфейс: **http://localhost:8001** (Nginx раздаёт `newui`, проксирует `/api/` на приложение);
- API напрямую: **http://localhost:8000**;
- PostgreSQL: порт **5432** (логин/пароль из `.env` или из `docker-compose.yml`: `postgres` / `postgres`).

Остановка:

```bash
docker compose -f docker/docker-compose.yml down
```

Данные БД сохраняются в Docker-volume `db-data`.

### Пересборка после изменений

```bash
docker compose -f docker/docker-compose.yml up --build -d
```

## Типовой сценарий использования

1. **Регистрация и вход**  
   Через экран входа/регистрации пользователь создаёт учётную запись или входит. После успешной аутентификации выдаётся JWT, который используется в заголовках запросов к API.

2. **Создание события**  
   Пользователь создаёт мероприятие: название, описание, даты, место. Указывает участников (по id или приглашая пользователей). Создатель получает роль организатора, участникам выставляются статусы (например, приглашён / участвует).

3. **Управление участниками**  
   В карточке события можно добавлять и удалять участников, менять их статусы и роли. Список участников используется при создании бюджетов и задач.

4. **Бюджет события**  
   Для события создаётся бюджет: общая сумма, описание. Добавляются расходы с привязкой к участникам и отметками «оплачено/не оплачено». Интерфейс позволяет видеть, кто и сколько внёс.

5. **Задачи**  
   В рамках события создаются задачи: заголовок, описание, автор, исполнитель, дедлайн. Статусы: новая, в работе, на проверке, выполнена. Исполнитель меняет статус и может отправить задачу на проверку. Список задач можно фильтровать по событию, автору, исполнителю, статусу.

6. **Работа с личным кабинетом**  
   В личном кабинете отображаются события пользователя, его задачи (как автора и как исполнителя) и связанные бюджеты.

Подробное описание API (эндпоинты, форматы запросов и ответов) доступно в Swagger UI после запуска приложения: **http://localhost:8000/docs** (или через тот же хост, на котором доступен backend).

## Описание репозитория

Репозиторий содержит единственное приложение Echo: исходный код backend (FastAPI), фронтенд (newui), конфигурацию Docker и Nginx, документацию по архитектуре и миграции БД. Ветки и теги используются для разработки фич (например, задачи, бюджет, роли). CI (например, линтер в `.github/workflows/linter.yml`) может подключаться для проверки кода при пушах. Подробная архитектура, диаграммы и технологический стек описаны в `docs/architecture.md`.
